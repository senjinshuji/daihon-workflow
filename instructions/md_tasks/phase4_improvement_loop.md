# Phase 4: æ”¹å–„ãƒ«ãƒ¼ãƒ—

## ðŸš¨ å¿…é ˆï¼šæœ€åˆã«å®Ÿè¡Œã™ã‚‹ã“ã¨
```bash
echo "ðŸ“– Phase 4è©³ç´°æŒ‡ç¤ºã‚’èª­ã¿è¾¼ã¿ä¸­..."
# ã“ã®è©³ç´°æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã ã“ã¨ã‚’TodoWriteã§è¨˜éŒ²ã—ã¦ãã ã•ã„
# TodoWrite: "Phase 4: phase4_improvement_loop.mdã‚’èª­ã¿è¾¼ã‚€" â†’ completed
```

## ðŸ“‹ ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã®ã‚¿ã‚¹ã‚¯
CDã‹ã‚‰çµ±åˆåˆ†æžãƒ¬ãƒãƒ¼ãƒˆã‚’å—é ˜å¾Œã€æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã«å‘ã‘ãŸæ”¹å–„ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

## å®Ÿè¡Œæ¡ä»¶
CDã‹ã‚‰ `integrated_analysis_loop[N].md` ã‚’å—ã‘å–ã£ãŸæ™‚ã«å®Ÿè¡Œ

## è©³ç´°æŒ‡ç¤º

### âœ… ã‚¿ã‚¹ã‚¯1: çµ±åˆåˆ†æžãƒ¬ãƒãƒ¼ãƒˆã®åˆ†æžã¨è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰æ±ºå®š

#### 1-1: å¹³å‡ç‚¹ã®ç¢ºèªã¨è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰é¸æŠž
```bash
# çµ±åˆåˆ†æžãƒ¬ãƒãƒ¼ãƒˆã‹ã‚‰å…¨ä½“å¹³å‡ç‚¹ã‚’ç¢ºèª
# integrated_analysis_loop[N].md ã®ã€Œå…¨ä½“å¹³å‡ã‚¹ã‚³ã‚¢ã€ã‚’å‚ç…§

# è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ã®è‡ªå‹•æ±ºå®š
if [ "$CURRENT_LOOP_NUM" -eq 1 ]; then
    EVAL_MODE="standard"
elif [ "$AVERAGE_SCORE" -lt 70 ]; then
    EVAL_MODE="standard"
elif [ "$AVERAGE_SCORE" -lt 85 ]; then
    EVAL_MODE="strict"
else
    EVAL_MODE="critical"
fi

echo "ðŸ“Š å‰å›žå¹³å‡ç‚¹: ${AVERAGE_SCORE}ç‚¹"
echo "ðŸŽ¯ æ¬¡å›žè©•ä¾¡ãƒ¢ãƒ¼ãƒ‰: ${EVAL_MODE}"
```

#### 1-2: æ”¹å–„ç‚¹ã®æŠ½å‡º
ä»¥ä¸‹ã®è¦³ç‚¹ã§åˆ†æžã—ã€æ”¹å–„ç‚¹ã‚’æŠ½å‡ºï¼š
- **é«˜è©•ä¾¡å°æœ¬ã®æˆåŠŸè¦å› **
- **ä½Žè©•ä¾¡å°æœ¬ã®æ”¹å–„ç‚¹**
- **ãƒšãƒ«ã‚½ãƒŠåˆ¥ã®åå¿œå‚¾å‘**
- **æ–°ãŸã«ç™ºè¦‹ã•ã‚ŒãŸã‚¤ãƒ³ã‚µã‚¤ãƒˆ**

### âœ… ã‚¿ã‚¹ã‚¯2: æ¬¡ãƒ«ãƒ¼ãƒ—ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

```bash
# ãƒ«ãƒ¼ãƒ—ç•ªå·ã‚’è¨­å®šï¼ˆä¾‹ï¼šloop2ï¼‰
CURRENT_LOOP_NUM=[ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ—ç•ªå·]  # ä¾‹: 1
NEXT_LOOP_NUM=$((CURRENT_LOOP_NUM + 1))
NEXT_LOOP="loop${NEXT_LOOP_NUM}"

# æ¬¡ãƒ«ãƒ¼ãƒ—ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir -p projects/$PROJECT_NAME/$NEXT_LOOP

# å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æˆæžœç‰©ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
cd projects/$PROJECT_NAME/$NEXT_LOOP
mkdir -p writer1 writer2 writer3
mkdir -p persona1 persona2 persona3

echo "ðŸ“ æ¬¡ãƒ«ãƒ¼ãƒ—ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ: projects/$PROJECT_NAME/$NEXT_LOOP"
echo "ðŸ“ å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”¨ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ: writer1-3, persona1-3"

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æˆ»ã‚‹
cd ../../..
```

### âœ… ã‚¿ã‚¹ã‚¯3: æ”¹å–„ç‰ˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

çµ±åˆåˆ†æžãƒ¬ãƒãƒ¼ãƒˆã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ï¼š

#### 3-1: ãƒ©ã‚¤ã‚¿ãƒ¼å‘ã‘æŒ‡ç¤ºæ›¸ã®æ›´æ–°
```bash
# å‰å›žã®æˆåŠŸè¦å› ã‚’åæ˜ ã—ãŸæ–°ã—ã„æŒ‡ç¤ºæ›¸ã‚’ä½œæˆ
cat > projects/$PROJECT_NAME/$NEXT_LOOP/copywriter_instructions.md << 'EOF'
# ãƒ©ã‚¤ã‚¿ãƒ¼å‘ã‘åˆ¶ä½œæŒ‡ç¤ºæ›¸ï¼ˆ${NEXT_LOOP}ç‰ˆï¼‰

## å‰å›žãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã®å­¦ç¿’äº‹é …
[çµ±åˆåˆ†æžã‹ã‚‰æŠ½å‡ºã—ãŸæˆåŠŸè¦å› ã‚’è¨˜è¼‰]

## æ”¹å–„ã•ã‚ŒãŸåŸºæœ¬æ–¹é‡
[æ›´æ–°ã•ã‚ŒãŸæ–¹é‡ã‚’è¨˜è¼‰]

## å¼·åŒ–ã•ã‚ŒãŸè¨´æ±‚ãƒã‚¤ãƒ³ãƒˆ
[ã‚ˆã‚ŠåŠ¹æžœçš„ãªè¨´æ±‚æ–¹æ³•ã‚’è¨˜è¼‰]
EOF
```

#### 3-2: è©•ä¾¡åŸºæº–ã®æ›´æ–°ï¼ˆè©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ä»˜ãï¼‰
```bash
# ã‚ˆã‚Šç²¾ç·»åŒ–ã•ã‚ŒãŸè©•ä¾¡åŸºæº–ã‚’ä½œæˆ
cat > projects/$PROJECT_NAME/$NEXT_LOOP/persona_evaluation_criteria.md << 'EOF'
# ãƒšãƒ«ã‚½ãƒŠè©•ä¾¡åŸºæº–

## è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰: ${EVAL_MODE}
â€»å‰å›žå¹³å‡${AVERAGE_SCORE}ç‚¹ã«åŸºã¥ã„ã¦è‡ªå‹•é¸æŠž

## ã‚¿ã‚¹ã‚¯
å‹•ç”»åºƒå‘Šå°æœ¬ã®è©•ä¾¡ - æä¾›ã•ã‚ŒãŸå°æœ¬ã‚’ä»¥ä¸‹ã®åŸºæº–ã§è©•ä¾¡ã—ã€æ”¹å–„ç‚¹ã‚’ææ¡ˆã™ã‚‹

[è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸåŸºæº–ã‚’è¨˜è¼‰]
EOF
```

#### 3-3: ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–æˆ¦ç•¥ã®æ›´æ–°
```bash
# æˆ¦ç•¥ã®æ”¹å–„ç‰ˆã‚’ä½œæˆ
cat > projects/$PROJECT_NAME/$NEXT_LOOP/creative_strategy.md << 'EOF'
# ç·åˆã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–æˆ¦ç•¥ï¼ˆ${NEXT_LOOP}ç‰ˆï¼‰

## å‰å›žãƒ«ãƒ¼ãƒ—ã®æˆæžœ
[å…·ä½“çš„ãªæˆæžœã¨å­¦ç¿’äº‹é …]

## æ”¹å–„ã•ã‚ŒãŸæˆ¦ç•¥
[æ–°ã—ã„æˆ¦ç•¥æ–¹é‡]
EOF
```

### âœ… ã‚¿ã‚¹ã‚¯4: ç›£ç£å½¹ã®èµ·å‹•ã¨CDã¸ã®æ¬¡ãƒ«ãƒ¼ãƒ—é–‹å§‹æŒ‡ç¤º

```bash
# ç›£ç£å½¹ã‚’èµ·å‹•
echo "ðŸ”¥ [MD] ${NEXT_LOOP} ã®ç›£ç£ã‚’é–‹å§‹ã—ã¾ã™ã€‚"
./supervisor.sh $NEXT_LOOP &
supervisor_pid=$!
echo "âœ… ç›£ç£å½¹ãŒèµ·å‹•ã—ã¾ã—ãŸ (PID: ${supervisor_pid})"

# CDã¸æ¬¡ãƒ«ãƒ¼ãƒ—é–‹å§‹ã‚’æŒ‡ç¤º
./bb-agent-send.sh cd "${NEXT_LOOP}åˆ¶ä½œé–‹å§‹ï¼š
å‰å›žã®çµ±åˆåˆ†æžã«åŸºã¥ãã€æˆ¦ç•¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚

ðŸ“Š å‰å›žå¹³å‡: ${AVERAGE_SCORE}ç‚¹
ðŸŽ¯ è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰: ${EVAL_MODE}

ðŸ“ˆ ä¸»ãªæ”¹å–„ç‚¹ï¼š
[å…·ä½“çš„ãªæ”¹å–„å†…å®¹ã‚’ç®‡æ¡æ›¸ã]

ðŸ“ æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«ï¼š
- copywriter_instructions.md
- persona_evaluation_criteria.mdï¼ˆ${EVAL_MODE}ãƒ¢ãƒ¼ãƒ‰ï¼‰
- creative_strategy.md

ðŸš¨ é‡è¦ï¼šè©•ä¾¡åŸºæº–ãŒ${EVAL_MODE}ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®šã•ã‚Œã¾ã—ãŸã€‚
ã‚ˆã‚ŠåŽ³æ ¼ãªè©•ä¾¡ã¨ãªã‚Šã¾ã™ãŒã€å°æœ¬å“è³ªã®å‘ä¸Šã‚’ç›®æŒ‡ã—ã¦ãã ã•ã„ã€‚

ðŸŽ¯ ã“ã‚Œã‚‰ã®æ–°æŒ‡ç¤ºæ›¸ã§${NEXT_LOOP}ã®åˆ¶ä½œã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚"
```

### å®Œäº†ç¢ºèª
```bash
echo "âœ… Phase 4: æ”¹å–„ãƒ«ãƒ¼ãƒ—å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚"
echo "ðŸ”„ ${NEXT_LOOP}ã®åˆ¶ä½œãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚"
```

## é‡è¦ãƒã‚¤ãƒ³ãƒˆ
- **åˆ†æžã®æ·±åº¦**: çµ±åˆåˆ†æžãƒ¬ãƒãƒ¼ãƒˆã‚’è©³ç´°ã«åˆ†æžã—ã€å…·ä½“çš„ãªæ”¹å–„ç‚¹ã‚’æŠ½å‡º
- **è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ç®¡ç†**: å‰å›žå¹³å‡ç‚¹ã«åŸºã¥ã„ã¦é©åˆ‡ãªè©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ã‚’è‡ªå‹•é¸æŠž
- **ç¶™ç¶šçš„æ”¹å–„**: å„ãƒ«ãƒ¼ãƒ—ã§ç€å®Ÿã«å“è³ªã‚’å‘ä¸Šã•ã›ã‚‹
- **æ˜Žç¢ºãªæŒ‡ç¤º**: CDã¸ã®æŒ‡ç¤ºã¯å…·ä½“çš„ã‹ã¤å®Ÿè¡Œå¯èƒ½ãªå†…å®¹ã«ã™ã‚‹
- **ãƒ«ãƒ¼ãƒ—ç•ªå·ç®¡ç†**: ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ—ç•ªå·ã‚’æ­£ç¢ºã«æŠŠæ¡ã—ã€æ¬¡ã®ãƒ«ãƒ¼ãƒ—ç•ªå·ã‚’é©åˆ‡ã«è¨­å®š

## è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®æœŸå¾…åŠ¹æžœ
- **standard (70-80ç‚¹ç›®æ¨™)**: åŸºæœ¬çš„ãªå“è³ªç¢ºä¿
- **strict (60-70ç‚¹ç›®æ¨™)**: ã‚ˆã‚Šå®¢è¦³çš„ãªè©•ä¾¡ã§æ”¹å–„ç‚¹ã‚’æ˜Žç¢ºåŒ–
- **critical (50-65ç‚¹ç›®æ¨™)**: æ¥­ç•Œæœ€é«˜æ°´æº–ã‚’ç›®æŒ‡ã™åŽ³æ ¼è©•ä¾¡ 