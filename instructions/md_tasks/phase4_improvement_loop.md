# Phase 4: 改善ループ

## 🚨 必須：最初に実行すること
```bash
echo "📖 Phase 4詳細指示を読み込み中..."
# この詳細指示ファイルを読み込んだことをTodoWriteで記録してください
# TodoWrite: "Phase 4: phase4_improvement_loop.mdを読み込む" → completed
```

## 📋 このフェーズのタスク
CDから統合分析レポートを受領後、次のループに向けた改善を実施します。

## 実行条件
CDから `integrated_analysis_loop[N].md` を受け取った時に実行

## 詳細指示

### ✅ タスク1: 統合分析レポートの分析と評価モード決定

#### 1-1: 平均点の確認と評価モード選択
```bash
# 統合分析レポートから全体平均点を確認
# integrated_analysis_loop[N].md の「全体平均スコア」を参照

# 評価モードの自動決定
if [ "$CURRENT_LOOP_NUM" -eq 1 ]; then
    EVAL_MODE="standard"
elif [ "$AVERAGE_SCORE" -lt 70 ]; then
    EVAL_MODE="standard"
elif [ "$AVERAGE_SCORE" -lt 85 ]; then
    EVAL_MODE="strict"
else
    EVAL_MODE="critical"
fi

echo "📊 前回平均点: ${AVERAGE_SCORE}点"
echo "🎯 次回評価モード: ${EVAL_MODE}"
```

#### 1-2: 改善点の抽出
以下の観点で分析し、改善点を抽出：
- **高評価台本の成功要因**
- **低評価台本の改善点**
- **ペルソナ別の反応傾向**
- **新たに発見されたインサイト**

### ✅ タスク2: 次ループ用ディレクトリの作成

```bash
# ループ番号を設定（例：loop2）
CURRENT_LOOP_NUM=[現在のループ番号]  # 例: 1
NEXT_LOOP_NUM=$((CURRENT_LOOP_NUM + 1))
NEXT_LOOP="loop${NEXT_LOOP_NUM}"

# 次ループ用ディレクトリを作成
mkdir -p projects/$PROJECT_NAME/$NEXT_LOOP

# 各エージェントの成果物用ディレクトリを作成
cd projects/$PROJECT_NAME/$NEXT_LOOP
mkdir -p writer1 writer2 writer3
mkdir -p persona1 persona2 persona3

echo "📁 次ループ用ディレクトリを作成: projects/$PROJECT_NAME/$NEXT_LOOP"
echo "📁 各エージェント用サブディレクトリを作成: writer1-3, persona1-3"

# プロジェクトディレクトリに戻る
cd ../../..
```

### ✅ タスク3: 改善版ファイルの作成

統合分析レポートに基づいて、以下のファイルを更新：

#### 3-1: ライター向け指示書の更新
```bash
# 前回の成功要因を反映した新しい指示書を作成
echo "6. ${NEXT_LOOP}のコピーライター向け指示書を作成します。"
cat > projects/${PROJECT_NAME}/loop${NEXT_LOOP}/copywriter_instructions.md << 'EOF'
# ライター向け制作指示書（${NEXT_LOOP}版）

## 全ループの統合分析サマリーと${NEXT_LOOP}の基本方針
- **統合分析サマリー**: [全ループの統合評価レポートを横断的に分析し、成功したクリエイティブのパターン、失敗したパターンの傾向を具体的に要約する。特に、どの戦略（WHO/FMT/USP/コンセプト）の組み合わせがどのペルソナに有効だったかを明確にすること。]
- **${NEXT_LOOP}の基本方針**: [上記の分析に基づき、次ループで全体として目指す戦略的な方向性を記述する。例：「ペルソナ2に刺さった『専門家解説形式』を横展開し、信頼性を軸に訴求を強化する」など。]

---

## Writer1への指示（改善版）

### 担当戦略パッケージ（データに基づく再構築）
- **WHO**: [全ループの分析結果に基づき、Writer1に最適化したターゲットを再定義]
- **FMT**: [全ループの分析結果に基づき、Writer1に最適化したフォーマットを再定義]
- **USP**: [全ループの分析結果に基づき、Writer1に最適化したUSPを再定義]
- **コンセプト**: [全ループの分析結果に基づき、Writer1に最適化したコンセプトを再定義]
- **キャッチコピー**: [全ループの分析結果に基づき、Writer1に最適化したキャッチコピーを再定義]
- **選定理由**: [なぜこの新しい組み合わせが次ループで成果を出すと考えるか、過去のデータ（特に成功・失敗事例）を引用して具体的に説明する。]

### その他指示（微調整）
- **専門性**: [新しい戦略パッケージに合わせて専門性を微調整]
- **訴求アプローチ**: [新しい戦略パッケージに合わせて記述]
- **キャラクター設定**: [新しい戦略パッケージに合わせて記述]
- **口調**: [新しい戦略パッケージに合わせて記述]

---

## Writer2への指示（改善版）

### 担当戦略パッケージ（データに基づく再構築）
- **WHO**: [全ループの分析結果に基づき、Writer2に最適化したターゲットを再定義]
- **FMT**: [全ループの分析結果に基づき、Writer2に最適化したフォーマットを再定義]
- **USP**: [全ループの分析結果に基づき、Writer2に最適化したUSPを再定義]
- **コンセプト**: [全ループの分析結果に基づき、Writer2に最適化したコンセプトを再定義]
- **キャッチコピー**: [全ループの分析結果に基づき、Writer2に最適化したキャッチコピーを再定義]
- **選定理由**: [なぜこの新しい組み合わせが次ループで成果を出すと考えるか、過去のデータ（特に成功・失敗事例）を引用して具体的に説明する。]

### その他指示（微調整）
- **専門性**: [新しい戦略パッケージに合わせて専門性を微調整]
- **訴求アプローチ**: [新しい戦略パッケージに合わせて記述]
- **キャラクター設定**: [新しい戦略パッケージに合わせて記述]
- **口調**: [新しい戦略パッケージに合わせて記述]

---

## Writer3への指示（改善版）

### 担当戦略パッケージ（データに基づく再構築）
- **WHO**: [全ループの分析結果に基づき、Writer3に最適化したターゲットを再定義]
- **FMT**: [全ループの分析結果に基づき、Writer3に最適化したフォーマットを再定義]
- **USP**: [全ループの分析結果に基づき、Writer3に最適化したUSPを再定義]
- **コンセプト**: [全ループの分析結果に基づき、Writer3に最適化したコンセプトを再定義]
- **キャッチコピー**: [全ループの分析結果に基づき、Writer3に最適化したキャッチコピーを再定義]
- **選定理由**: [なぜこの新しい組み合わせが次ループで成果を出すと考えるか、過去のデータ（特に成功・失敗事例）を引用して具体的に説明する。]

### その他指示（微調整）
- **専門性**: [新しい戦略パッケージに合わせて専門性を微調整]
- **訴求アプローチ**: [新しい戦略パッケージに合わせて記述]
- **キャラクター設定**: [新しい戦略パッケージに合わせて記述]
- **口調**: [新しい戦略パッケージに合わせて記述]

EOF
```

#### 3-2: ペルソナ評価基準の更新
```bash
echo "7. ${NEXT_LOOP}のペルソナ評価基準を作成します。"
cat > projects/${PROJECT_NAME}/loop${NEXT_LOOP}/persona_evaluation_criteria.md << 'EOF'
# ペルソナ評価基準（${NEXT_LOOP}版）

## 評価モード: ${EVAL_MODE}
- **選定理由**: 全ループの統合分析サマリーに基づき、[なぜこの評価モードが次ループに最適か記述。例えば「成功パターンが見えてきたため、基準を厳格化し再現性を高める」など]

## 全ループの学びと評価方針の更新
- **全ループからの学び**: [統合分析レポートから、特に評価基準の改善に繋がる発見を要約。例：ペルソナ2はデータへの反応が良く、評価項目として強化すべき。感情的な訴求は評価が割れたため、基準を明確化する必要がある。]
- **評価方針の更新**: [上記の学びに基づき、評価項目、配点、ペルソナ別ウェイトなどをどのように変更するかの全体方針を記述。]

---

## 必須評価項目（改訂版）
*各10点満点。項目は統合分析に基づき見直すこと（新規追加、統合、削除など）。*

### 1. [項目名1]
**チェックポイント（${NEXT_LOOP}版）**:
- [統合分析に基づき、チェックポイントを具体化・更新]
- 
- 

### 2. [項目名2]【新規追加 or 配点強化など】
**チェックポイント（${NEXT_LOOP}版）**:
- [統合分析に基づき、チェックポイントを具体化・更新]
- 
- 

... (同様の項目を10個程度、統合分析に基づき記述)

---

## ペルソナ別評価ウェイト（${NEXT_LOOP}調整）
*統合分析に基づき、各ペルソナの反応が良かった要素を重点評価するようウェイトを調整*

### Persona1（[ターゲット層]）
**重視項目**:
- [項目名]（×1.2倍など）
- [項目名]（×1.1倍など）

### Persona2（[ターゲット層]）
**重視項目**:
- [項目名]（×1.2倍など）
- [項目名]（×1.1倍など）

### Persona3（[ターゲット層]）
**重視項目**:
- [項目名]（×1.2倍など）
- [項目名]（×1.1倍など）

---

## ${NEXT_LOOP}での評価目標
- [例: 全台本80点以上]
- [例: 各ペルソナで90点以上の台本を最低1本]
- [例: 全体平均90点の達成]
EOF
```

#### 3-3: クリエイティブ戦略の更新
```bash
# 戦略の改善版を作成
cat > projects/$PROJECT_NAME/$NEXT_LOOP/creative_strategy.md << 'EOF'
# 総合クリエイティブ戦略（${NEXT_LOOP}版）

## 前回ループの成果
[具体的な成果と学習事項]

## 改善された戦略
[新しい戦略方針]
EOF
```

### ✅ タスク4: 監督役の起動とCDへの次ループ開始指示

```bash
# 監督役を起動
echo "🔥 [MD] ${NEXT_LOOP} の監督を開始します。"
./supervisor.sh $NEXT_LOOP &
supervisor_pid=$!
echo "✅ 監督役が起動しました (PID: ${supervisor_pid})"

# CDへ次ループ開始を指示
./bb-agent-send.sh cd "${NEXT_LOOP}制作開始：
前回の統合分析に基づき、戦略ファイルを更新しました。

📊 前回平均: ${AVERAGE_SCORE}点
🎯 評価モード: ${EVAL_MODE}

📈 主な改善点：
[具体的な改善内容を箇条書き]

📁 更新ファイル：
- copywriter_instructions.md
- persona_evaluation_criteria.md（${EVAL_MODE}モード）
- creative_strategy.md

🚨 重要：評価基準が${EVAL_MODE}モードに設定されました。
より厳格な評価となりますが、台本品質の向上を目指してください。

🎯 これらの新指示書で${NEXT_LOOP}の制作を開始してください。"
```

### 完了確認
```bash
echo "✅ Phase 4: 改善ループ処理が完了しました。"
echo "🔄 ${NEXT_LOOP}の制作が開始されます。"
```
## 重要ポイント
- **分析の深度**: 統合分析レポートを詳細に分析し、具体的な改善点を抽出
- **評価モード管理**: 前回平均点に基づいて適切な評価モードを自動選択
- **継続的改善**: 各ループで着実に品質を向上させる
- **明確な指示**: CDへの指示は具体的かつ実行可能な内容にする
- **ループ番号管理**: 現在のループ番号を正確に把握し、次のループ番号を適切に設定

## 評価モード別の期待効果
- **standard (70-80点目標)**: 基本的な品質確保
- **strict (60-70点目標)**: より客観的な評価で改善点を明確化
- **critical (50-65点目標)**: 業界最高水準を目指す厳格評価 
